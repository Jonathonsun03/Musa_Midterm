---
title: "Hedonic Home Price Prediction"
author: "Jonathon Sun, Johnathan Clementi"
date: "9/29/2021"
output: html_document
---

```{r setup, include=FALSE}
pacman::p_load(tidyverse, tidycensus, sf, kableExtra, tmap, viridis, esquisse, gridExtra, spdep, caret, ckanr, FNN, grid, gridExtra, ggcorplot)

source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")

palette5 <- c("#25CB10", "#5AB60C", "#8FA108",   "#C48C04", "#FA7800")
```

## Pulling Data

```{r tidycensus pressure, echo=FALSE}

#variables on frequency of Race
Variables <- load_variables(2019,
                            "acs5",
                            cache = TRUE) %>%
  mutate(Merge_name = paste(name,"E", sep ="")) %>%
  filter(grepl("RACE", concept)) %>%
  filter(!grepl("AGE", concept)) %>%
  slice(1:10)

#variable median age, men and women not by race
A <- load_variables(2019,
                    "acs5",
                    cache = TRUE) %>%
  mutate(Merge_name = paste(name,"E", sep ="")) %>%
  filter(grepl("MEDIAN", concept)) %>%
  slice(1:3)

#Median Household Income
B <- load_variables(2019,
                    "acs5",
                    cache = TRUE) %>%
  mutate(Merge_name = paste(name,"E", sep ="")) %>%
  filter(grepl("MEDIAN INCOME", concept)) %>%
  slice(1)

# Cost of living
C <- load_variables(2019,
                    "acs5",
                    cache = TRUE) %>%
  mutate(Merge_name = paste(name,"E", sep ="")) %>%
  filter(grepl("COST", concept)) %>%
  slice(1:19)



Variables <- bind_rows(Variables, A, B, C)

acsTractsCol.2019.sf <- get_acs(geography = "tract",
        year = 2019,
        variables = Variables$name, 
        state="Colorado",
        county= c("Boulder"),
        geometry=T,
        output = "wide") %>% 
  st_transform('ESRI:102653') %>%
  dplyr::select (GEOID, NAME, all_of(paste0(Variables$name,"E")))

ggplot() +
  geom_sf(data = acsTractsCol.2019.sf)
```

Website available for data https://open-data.bouldercolorado.gov/ 


```{r colorado_data}
# Use CRS ESRI:102653 - Colorado State Plane North: https://spatialreference.org/ref/esri/102653/


# Locations of 19 libraries 
## https://opendata-bouldercounty.hub.arcgis.com/datasets/libraries-2/explore?location=40.001009%2C-105.302539%2C11.28

Col_Library <- st_read("https://opendata.arcgis.com/datasets/7f4ea25ba87345e380d2e896611d2588_0.geojson") %>%
  st_transform('ESRI:102653')

ggplot() +
  geom_sf(data = st_union(acsTractsCol.2019.sf),
          fill = "transparent") +
  geom_sf(data = Col_Library) +
  labs(title = "library")
#addresses for buildings https://open-data.bouldercolorado.gov/datasets/d63e537da54640bd967c2fedc4c99a92_0/explore?location=40.026211%2C-105.232810%2C11.82 
Addresses <- st_read("https://opendata.arcgis.com/datasets/d63e537da54640bd967c2fedc4c99a92_0.geojson") %>%
  st_transform('ESRI:102653')

ggplot() +
  geom_sf(data = st_union(acsTractsCol.2019.sf),
          fill = "transparent") +
  geom_sf(data = Addresses) +
  labs(title = "Addresses")
# Properties managed by parks and recreation polygons ## https://open-data.bouldercolorado.gov/datasets/fdfc0410e75c48b6b9e53cf94bdbe224_1/explore?location=40.026750%2C-105.234200%2C12.05 
Parks <- st_read("https://opendata.arcgis.com/datasets/fdfc0410e75c48b6b9e53cf94bdbe224_1.geojson")

# Grocery Stores from Data Axle
Grocery_Store <- read.csv("DataAxle_GroceryStores.csv") %>%
  st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326, agr = "constant") %>%
  st_transform('ESRI:102653') 

ggplot() +
  geom_sf(data = st_union(acsTractsCol.2019.sf),
          fill = "transparent") +
  geom_sf(data = Grocery_Store) +
  labs(title = "Grocery_Stores")

#Restaurants from DataAxle
Restaurants <- bind_rows(read.csv("DataAxle_Restaurants_1.csv"), read.csv("DataAxle_Restaurants_2.csv")) %>%
  st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326, agr = "constant") %>%
  st_transform('ESRI:102653')

ggplot() +
  geom_sf(data = st_union(acsTractsCol.2019.sf),
          fill = "transparent") +
  geom_sf(data = Restaurants) +
  labs(title = "Restaurants")


#Education from DataAxle
Education <- read.csv("DataAxle_Education.csv") %>%
  st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326, agr = "constant") %>%
  st_transform('ESRI:102653')

ggplot() +
  geom_sf(data = st_union(acsTractsCol.2019.sf),
          fill = "transparent") +
  geom_sf(data = Education) +
  labs(title = "Schools")

#Museums from DataAxle
Museums <- read.csv("DataAxle_Musuems.csv") %>%
  st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326, agr = "constant") %>%
  st_transform('ESRI:102653')

ggplot() +
  geom_sf(data = st_union(acsTractsCol.2019.sf),
          fill = "transparent") +
  geom_sf(data = Museums) +
  labs(title = "Museums")


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
